(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{3533:function(t,e,n){"use strict";n.d(e,{W:function(){return s}});var o=n(2777),i=n(2262),s=function(){function t(){(0,o.Z)(this,t)}return(0,i.Z)(t,null,[{key:"getCanvasId",value:function(){return"myCanvasId"}},{key:"removeCanvas",value:function(){var e=t.getCanvasId(),n=document.getElementById(e);n.parentNode.removeChild(n)}},{key:"maybeCreateCanvas",value:function(){var e=t.getCanvasId(),n=document.getElementById(e);return n||((n=document.createElement("canvas")).id=e,document.body.appendChild(n)),e}}]),t}()},8571:function(t,e,n){"use strict";function o(t,e,n,o,i,s,a){try{var h=t[s](a),r=h.value}catch(c){return void n(c)}h.done?e(r):Promise.resolve(r).then(o,i)}n.r(e),n.d(e,{default:function(){return y}});var i=n(7794),s=n.n(i),a=n(7294),h=n(3687),r=n(9477);function c(t,e,n){let{color:o=65280,scale:i=1,onInit:s,onUpdate:a}=void 0===n?{}:n;const c=[],d=new r.vBJ({color:null!=o?o:65280,wireframe:!0}),u=new h.AO,p=new h.AO,m=new h.AO,l=new h._f,v=new r.xo$(1),f=new r.DvJ(1,1,1),y=new r._12(10,10,10,10);function w(e){let n=new r.Kj0;const{SPHERE:o,BOX:i,PLANE:s,CYLINDER:a,CONVEXPOLYHEDRON:c,TRIMESH:l,HEIGHTFIELD:w}=h.bn.types;switch(e.type){case o:n=new r.Kj0(v,d);break;case i:n=new r.Kj0(f,d);break;case s:n=new r.Kj0(y,d);break;case a:{const t=new r.fHI(e.radiusTop,e.radiusBottom,e.height,e.numSegments);n=new r.Kj0(t,d),e.geometryId=t.id;break}case c:{const t=function(t){const e=new r.u9r,n=[];for(let i=0;i<t.vertices.length;i++){const e=t.vertices[i];n.push(e.x,e.y,e.z)}e.setAttribute("position",new r.a$l(n,3));const o=[];for(let i=0;i<t.faces.length;i++){const e=t.faces[i],n=e[0];for(let t=1;t<e.length-1;t++){const i=e[t],s=e[t+1];o.push(n,i,s)}}return e.setIndex(o),e.computeBoundingSphere(),e.computeVertexNormals(),e}(e);n=new r.Kj0(t,d),e.geometryId=t.id;break}case l:{const t=function(t){const e=new r.u9r,n=[],o=u,i=p,s=m;for(let a=0;a<t.indices.length/3;a++)t.getTriangleVertices(a,o,i,s),n.push(o.x,o.y,o.z),n.push(i.x,i.y,i.z),n.push(s.x,s.y,s.z);return e.setAttribute("position",new r.a$l(n,3)),e.computeBoundingSphere(),e.computeVertexNormals(),e}(e);n=new r.Kj0(t,d),e.geometryId=t.id;break}case w:{const t=function(t){const e=new r.u9r,n=t.elementSize||1,o=t.data.flatMap(((t,e)=>t.flatMap(((t,o)=>[e*n,o*n,t])))),i=[];for(let s=0;s<t.data.length-1;s++)for(let e=0;e<t.data[s].length-1;e++){const n=t.data[s].length,o=s*n+e;i.push(o+1,o+n,o+n+1),i.push(o+n,o+1,o)}return e.setIndex(i),e.setAttribute("position",new r.a$l(o,3)),e.computeBoundingSphere(),e.computeVertexNormals(),e}(e);n=new r.Kj0(t,d),e.geometryId=t.id;break}}return t.add(n),n}function g(e,n){let o=c[e],s=!1;return function(t,e){if(!t)return!1;const{geometry:n}=t;return n instanceof r.xo$&&e.type===h.bn.types.SPHERE||n instanceof r.DvJ&&e.type===h.bn.types.BOX||n instanceof r._12&&e.type===h.bn.types.PLANE||n.id===e.geometryId&&e.type===h.bn.types.CYLINDER||n.id===e.geometryId&&e.type===h.bn.types.CONVEXPOLYHEDRON||n.id===e.geometryId&&e.type===h.bn.types.TRIMESH||n.id===e.geometryId&&e.type===h.bn.types.HEIGHTFIELD}(o,n)||(o&&t.remove(o),c[e]=o=w(n),s=!0),function(t,e){const{SPHERE:n,BOX:o,PLANE:s,CYLINDER:a,CONVEXPOLYHEDRON:r,TRIMESH:c,HEIGHTFIELD:d}=h.bn.types;switch(e.type){case n:{const{radius:n}=e;t.scale.set(n*i,n*i,n*i);break}case o:t.scale.copy(e.halfExtents),t.scale.multiplyScalar(2*i);break;case s:break;case a:case r:t.scale.set(1*i,1*i,1*i);break;case c:t.scale.copy(e.scale).multiplyScalar(i);break;case d:t.scale.set(1*i,1*i,1*i)}}(o,n),s}return y.translate(0,0,1e-4),{update:function(){const n=c,o=u,i=l;let h=0;for(const t of e.bodies)for(let e=0;e!==t.shapes.length;e++){const r=t.shapes[e],c=g(h,r),d=n[h];d&&(t.quaternion.vmult(t.shapeOffsets[e],o),t.position.vadd(o,o),t.quaternion.mult(t.shapeOrientations[e],i),d.position.copy(o),d.quaternion.copy(i),c&&s instanceof Function&&s(t,d,r),!c&&a instanceof Function&&a(t,d,r)),h++}for(let e=h;e<n.length;e++){const o=n[e];o&&t.remove(o)}n.length=h}}}var d=n(3533),u=n(2777),p=n(2262),m=n(9499),l=function(){function t(e){var n=this;(0,u.Z)(this,t),(0,m.Z)(this,"canvasId",void 0),(0,m.Z)(this,"fov",void 0),(0,m.Z)(this,"nearPlane",void 0),(0,m.Z)(this,"farPlane",void 0),(0,m.Z)(this,"canvas",void 0),(0,m.Z)(this,"onWindowResize",void 0),(0,m.Z)(this,"scene",void 0),(0,m.Z)(this,"camera",void 0),(0,m.Z)(this,"renderer",void 0),(0,m.Z)(this,"clock",void 0),(0,m.Z)(this,"ambientLight",void 0),(0,m.Z)(this,"directionalLight",void 0),(0,m.Z)(this,"cameraRotationDepth",void 0),this.fov=45,this.nearPlane=1,this.farPlane=1e3,this.canvasId=e,this.scene=new r.xsS,this.camera=new r.cPb(this.fov,window.innerWidth/window.innerHeight,1,1e3),this.camera.position.y=4,this.canvas=document.getElementById(this.canvasId),this.renderer=new r.CP7({canvas:this.canvas,antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.cameraRotationDepth=12,this.clock=new r.SUY,this.ambientLight=new r.Mig(16777215,.5),this.ambientLight.castShadow=!0,this.scene.add(this.ambientLight),this.directionalLight=new r.Ox3(16777215,1),this.directionalLight.position.set(0,32,64),this.scene.add(this.directionalLight),this.onWindowResize=function(){console.log("resize"),n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(window.innerWidth,window.innerHeight)},window.addEventListener("resize",this.onWindowResize,!1)}return(0,p.Z)(t,[{key:"destroy",value:function(){for(;this.scene.children.length>0;)this.scene.remove(this.scene.children[0]);this.scene.removeFromParent(),this.camera.removeFromParent(),window.removeEventListener("resize",this.onWindowResize)}},{key:"update",value:function(){this.renderer.render(this.scene,this.camera)}},{key:"udpateCameraPosition",value:function(){var t=Math.sin(.25*this.clock.getElapsedTime()),e=Math.cos(.25*this.clock.getElapsedTime());this.camera.position.x=this.cameraRotationDepth*t,this.camera.position.z=this.cameraRotationDepth*e,this.camera.lookAt(new r.Pa4(0,2,0))}}]),t}(),v=function(){function t(){(0,u.Z)(this,t),(0,m.Z)(this,"x",void 0),(0,m.Z)(this,"y",void 0),(0,m.Z)(this,"z",void 0),(0,m.Z)(this,"phantomX",void 0),(0,m.Z)(this,"phantomY",void 0),(0,m.Z)(this,"phantomZ",void 0),(0,m.Z)(this,"groundX",void 0),(0,m.Z)(this,"groundY",void 0),(0,m.Z)(this,"groundZ",void 0),(0,m.Z)(this,"size",void 0),(0,m.Z)(this,"mass",void 0),(0,m.Z)(this,"existingBlocks",void 0),(0,m.Z)(this,"phantomBlockAccepted",void 0),(0,m.Z)(this,"gameLoopLength",void 0),(0,m.Z)(this,"currentLoopLength",void 0),(0,m.Z)(this,"phantomShape",void 0),(0,m.Z)(this,"phantomMesh",void 0),(0,m.Z)(this,"phantomGroup",void 0),(0,m.Z)(this,"world",void 0),(0,m.Z)(this,"gg",void 0),(0,m.Z)(this,"compoundBody",void 0),(0,m.Z)(this,"compoundShapeGroup",void 0),this.x=0,this.y=0,this.z=0,this.phantomX=0,this.phantomY=0,this.phantomZ=0,this.groundX=0,this.groundY=-1,this.groundZ=0,this.size=1,this.mass=10,this.existingBlocks=[],this.phantomBlockAccepted=!1,this.gameLoopLength=.5,this.currentLoopLength=0,this.phantomShape=void 0,this.world=new h.q3({gravity:new h.AO(0,-10,0)}),this._addGround(),this.compoundBody=this._createCompoundBody(),this.world.addBody(this.compoundBody),this.gg=new r.ZAu,this._initGame(),this.compoundShapeGroup=new r.ZAu;var e=new r.DvJ(1,1,1),n=new r.xoR({color:16448250}),o=new r.Kj0(e,n);this.compoundShapeGroup.add(o),this.gg.add(this.compoundShapeGroup),this.phantomGroup=new r.ZAu,this.gg.add(this.phantomGroup)}return(0,p.Z)(t,[{key:"update",value:function(t){this.world.fixedStep(),this.currentLoopLength+=t,this.currentLoopLength>this.gameLoopLength&&(this.currentLoopLength=0,this._displayPhantomBlock()),this._animatePhantomGroup(),this._animateCompoundShapeGroup()}},{key:"_updateCenterOfMass",value:function(){var t=new h.AO;this.compoundBody.shapeOffsets.forEach((function(e){t.vadd(e,t)})),t.scale(1/this.compoundBody.shapes.length,t),this.compoundBody.shapeOffsets.forEach((function(e){e.vsub(t,e)}));var e=new h.AO;this.compoundBody.vectorToWorldFrame(t,e),this.compoundBody.position.vadd(e,this.compoundBody.position)}},{key:"_randomizePhantomXYZHelper",value:function(){var t=Math.floor(3*Math.random()),e=0===Math.floor(2*Math.random())?1:-1;0===t?this.phantomX+=e:1===t?this.y<=.1?this.phantomY=1:this.phantomY+=e:this.phantomZ+=e}},{key:"_randomizePhantomXYZ",value:function(){var t=this;this._updatePhantomXYZ(),this._randomizePhantomXYZHelper();for(;t.existingBlocks.some((function(e){return e.x===t.phantomX&&e.y===t.phantomY&&e.z===t.phantomZ}));)this._updatePhantomXYZ(),this._randomizePhantomXYZHelper()}},{key:"addBlockToScene",value:function(t,e,n){var o=new r.DvJ(1,1,1),i=new r.xoR({color:16448250}),s=new r.Kj0(o,i);s.position.x=t,s.position.y=e,s.position.z=n,this.compoundShapeGroup.add(s)}},{key:"_addPhantomBlock",value:function(t,e,n){var o=new r.DvJ(1,1,1),i=new r.xoR({color:6413307,transparent:!0,opacity:.5});this.phantomMesh=new r.Kj0(o,i);var s=this.compoundBody.shapeOffsets[0].x,a=this.compoundBody.shapeOffsets[0].y,h=this.compoundBody.shapeOffsets[0].z;this.phantomMesh.position.x=t+s,this.phantomMesh.position.y=e+a,this.phantomMesh.position.z=n+h,this.phantomGroup.add(this.phantomMesh)}},{key:"_displayPhantomBlock",value:function(){var t;(this._randomizePhantomXYZ(),this.phantomBlockAccepted)?(this.phantomBlockAccepted=!1,this.addBlockToScene(this.x,this.y,this.z),console.log(null===(t=this.compoundBody)||void 0===t?void 0:t.shapeOffsets)):void 0!==this.phantomShape&&this.compoundBody.removeShape(this.phantomShape);this.phantomShape=new h.xu(new h.AO(.5*this.size,.5*this.size,.5*this.size));var e=this.compoundBody.shapeOffsets[0].x,n=this.compoundBody.shapeOffsets[0].y,o=this.compoundBody.shapeOffsets[0].z;this.compoundBody.addShape(this.phantomShape,new h.AO(this.phantomX*this.size+e,this.phantomY*this.size+n,this.phantomZ*this.size+o)),void 0!==this.phantomMesh&&this.phantomGroup.remove(this.phantomMesh),this._addPhantomBlock(this.phantomX,this.phantomY,this.phantomZ)}},{key:"_updatePhantomXYZ",value:function(){this.phantomX=this.x,this.phantomY=this.y,this.phantomZ=this.z}},{key:"_updateXYZ",value:function(){this.x=this.phantomX,this.y=this.phantomY,this.z=this.phantomZ}},{key:"acceptPhantomBlock",value:function(){this._updateXYZ(),this._addExistingBlock(),this._updateCenterOfMass(),this.phantomBlockAccepted=!0,this.currentLoopLength=this.gameLoopLength+1}},{key:"_addExistingBlock",value:function(){this.existingBlocks.push({x:this.x,y:this.y,z:this.z})}},{key:"_animatePhantomGroup",value:function(){this.phantomGroup.position.copy(this.compoundBody.position),this.phantomGroup.quaternion.copy(this.compoundBody.quaternion)}},{key:"_animateCompoundShapeGroup",value:function(){var t=this;this.compoundShapeGroup.position.copy(this.compoundBody.position),this.compoundShapeGroup.quaternion.copy(this.compoundBody.quaternion),this.compoundShapeGroup.children.forEach((function(e,n){var o=t.compoundBody.shapeOffsets[n],i=t.compoundBody.shapeOrientations[n];e.position.copy(o),e.quaternion.copy(i)}))}},{key:"_createCompoundBody",value:function(){var t=new h.xu(new h.AO(.5*this.size,.5*this.size,.5*this.size)),e=new h.F5("slippery");e.friction=.01;var n=new h.uT({mass:this.mass,material:e});return n.position.set(0,0,0),n.quaternion.setFromEuler(0,0,0),n.addShape(t,new h.AO(this.x,this.y,this.z)),this._addExistingBlock(),n}},{key:"_addGround",value:function(){var t=new h.F5("ground");t.friction=.5;var e=new h.xu(new h.AO(1.5,.5,1.5)),n=new h.uT({mass:0,material:t});n.addShape(e),n.quaternion.setFromEuler(0,0,0),n.position.set(this.groundX,this.groundY,this.groundZ),this.world.addBody(n)}},{key:"_initGame",value:function(){var t=new r.DvJ(3,1,3),e=new r.xoR({color:2195968}),n=new r.Kj0(t,e);n.position.y=-1,this.gg.add(n)}}]),t}(),f=n(5893);function y(){var t,e=(0,a.useRef)(0);return(0,a.useEffect)((function(){var i=d.W.maybeCreateCanvas(),a=new l(i),h=new v;a.scene.add(h.gg);c(a.scene,h.world);var r=function(){var e,i=(e=s().mark((function e(){var o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(376).then(n.bind(n,4376));case 2:o=e.sent,(t=new o.GUI).add(a,"cameraRotationDepth",5,100).name("Camera Distance").onChange((function(t){}));case 5:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(i,s){var a=e.apply(t,n);function h(t){o(a,i,s,h,r,"next",t)}function r(t){o(a,i,s,h,r,"throw",t)}h(void 0)}))});return function(){return i.apply(this,arguments)}}();r();!function t(){var e=a.clock.getDelta();a.update(),a.udpateCameraPosition(),h.update(e),requestAnimationFrame(t)}();var u=function(t){h.acceptPhantomBlock()},p=function(t){"Space"===t.code&&h.acceptPhantomBlock()};return window.addEventListener("click",u),window.addEventListener("keydown",p),function(){console.log("on component unmount"),window.removeEventListener("click",u),window.removeEventListener("keydown",p),a.destroy(),window.cancelAnimationFrame(e.current),d.W.removeCanvas(),t.destroy()}}),[]),(0,f.jsx)("div",{children:(0,f.jsx)("canvas",{id:d.W.getCanvasId()})})}},6797:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/frantic-architect",function(){return n(8571)}])},2777:function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,{Z:function(){return o}})},2262:function(t,e,n){"use strict";function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}n.d(e,{Z:function(){return i}})}},function(t){t.O(0,[737,884,774,888,179],(function(){return e=6797,t(t.s=e);var e}));var e=t.O();_N_E=e}]);